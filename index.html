<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Test API GAS</title>
</head>
<body>
  <h1>Test Google Apps Script - POST sin CORS</h1>
  <button onclick="probarGET()">Probar GET</button>
  <button onclick="probarPOST()">Probar POST</button>

  <script>
    const API_URL = "https://script.google.com/macros/s/AKfycbw4H2X5V7foBGwhJQTe4kVRp2sSHuascPS2C6JG1CUuai8l1QcXGLL-fbj9NLd0Mv3D/exec";

    async function probarGET() {
      try {
        const res = await fetch(API_URL);
        const data = await res.json();
        console.log("GET OK:", data);
        alert("GET OK (mira la consola)");
      } catch (err) {
        console.error("Error GET:", err);
        alert("Error en GET");
      }
    }

    async function probarPOST() {
      try {
        const res = await fetch(API_URL, {
          method: "POST",
          mode: "no-cors",  // ⚠️ Obligatorio para evitar CORS
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            referencia: "TEST-123",
            centro: "Eroski",
            solicitadoPor: "Tester",
            descripcion: "Incidencia de prueba",
            materiales: "Ninguno",
            foto: "",
            fechaApertura: new Date().toISOString(),
            fechaCierre: "",
            cerrada: false
          })
        });
        // ⚠️ Con 'no-cors', no puedes leer 'res', pero se envía
        console.log("POST enviado (modo no-cors). No puedes ver la respuesta.");
        alert("✅ Incidencia enviada (modo no-cors). Revisa tu hoja de cálculo.");
      } catch (err) {
        // En 'no-cors', el catch puede no dispararse
        console.error("Error POST:", err);
      }
    }
  </script>
</body>
</html>