<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Gesti√≥n de Incidencias - EROSKI</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet"/>
  <style>
    body { background-color: #f8f9fa; padding-top: 20px; }
    .card { box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
    .img-thumbnail { cursor: pointer; }
    .closed-badge { background-color: #d32f2f; color: white; }
    .open-badge { background-color: #2e7d32; color: white; }
    .search-section { background-color: #e8f5e8; padding: 15px; border-radius: 8px; }
    .photo-preview { max-width: 100px; margin: 5px; }
  </style>

  <!-- üîê LOGIN LOCAL: Acceso con contrase√±a -->
  <script>
    const ACCESS_PASSWORD = '123456';  // ‚Üê Cambia esta contrase√±a
    const ACCESS_USER = 'LCC';           // ‚Üê Cambia el usuario si quieres

    function requestAccess() {
      const maxAttempts = 3;
      let attempts = 0;

      while (attempts < maxAttempts) {
        const user = prompt('üîê Acceso restringido\nUsuario:', '');
        if (user === null) {
          document.body.innerHTML = '<h1 class="text-center mt-5">Acceso denegado</h1>';
          return false;
        }

        const pass = prompt('üîê Contrase√±a:', '');
        if (pass === null) {
          document.body.innerHTML = '<h1 class="text-center mt-5">Acceso denegado</h1>';
          return false;
        }

        if (user === ACCESS_USER && pass === ACCESS_PASSWORD) {
          return true;
        }

        attempts++;
        alert(`Contrase√±a incorrecta. Intento ${attempts}/${maxAttempts}`);
      }

      document.body.innerHTML = '<h1 class="text-center mt-5">üö´ Acceso bloqueado</h1>';
      return false;
    }

    if (!requestAccess()) throw new Error('Acceso denegado');
  </script>
</head>
<body>

<div class="container">
  <h1 class="text-center mb-4">Gesti√≥n de Incidencias - <strong>SUPERMERCADOS EROSKI</strong></h1>

  <!-- Pesta√±as -->
  <ul class="nav nav-tabs mb-4" id="appTabs">
    <li class="nav-item"><a class="nav-link active" data-bs-toggle="tab" href="#nueva">Nueva Incidencia</a></li>
    <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#abiertas">Incidencias Abiertas</a></li>
    <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#cerradas">Cerradas</a></li>
  </ul>

  <div class="tab-content">

    <!-- 1. NUEVA INCIDENCIA -->
    <div class="tab-pane fade show active" id="nueva">
      <div class="card">
        <div class="card-body">
          <h5 class="card-title">Registrar Nueva Incidencia</h5>
          <form id="formIncidencia">
            <div class="mb-3">
              <label for="centro" class="form-label">Centro EROSKI</label>
              <select class="form-select" id="centro" required>
                <option value="">Selecciona un centro</option>
                <option>Eroski Binissalem I (6705)</option>
                <option>Eroski Binissalen II (6096)</option>
                <option>Eroski NOVA PARIS-CALVIA (7490)</option>
                <option>Eroski Secar (6495)</option>
                <option>Eroski Son Moix (6801)</option>
                <option>Eroski Dragonera (6350)</option>
                <option>Eroski La Puebla (6362)</option>
                <option>La Puebla 2 (6067)</option>
                <option>Eroski Bendinat (6752)</option>
                <option>Eroski Indioteria (6514)</option>
                <option>Eroski Son Cladera (6538)</option>
                <option>Eroski Mercat de Llevant (6729)</option>
                <option>Eroski Portixol (6753)</option>
                <option>Eroski Can Pastilla (6806)</option>
                <option>Eroski Borne (6831)</option>
                <option>Eroski Santa Mar√≠a I (6309)</option>
                <option>Eroski Santa Mar√≠a II (6694)</option>
                <option>Eroski Escorxador (6363)</option>
                <option>Eroski Coll I (6376)</option>
                <option>Eroski Coll II (6718)</option>
                <option>Eroski Palmanova (6537)</option>
                <option>Eroski Santanvi (6713)</option>
                <option>Eroski Colonia (6499)</option>
                <option>Eroski M√©dico Jose Darder (6749)</option>
                <option>Eroski Consell (6643)</option>
                <option>Eroski Soller II (6692)</option>
                <option>Eroski Capit√°n Salom (6892)</option>
                <option>Eroski Campos II (6653)</option>
                <option>Eroski Llucmajor (6759)</option>
                <option>Eroski Pascual Ribot (6882)</option>
                <option>Eroski Alar√≥ (6719)</option>
                <option>Eroski Lloseta (6308)</option>
                <option>Eroski Capit√°n Salom II (7558)</option>
                <option>Eroski Son Rullan (6439)</option>
                <option>Eroski Son Ferriol (6714)</option>
                <option>Eroski Pascual Ribot II (7557)</option>
                <option>Eroski F√°brica (6983)</option>
                <option>Eroski Archiduque (6625)</option>
                <option>Eroski Navegaci√≥n (7503)</option>
                <option>Eroski Inca (6398)</option>
                <option>Eroski Inca IV NORTE (6066)</option>
                <option>Eroski Andrea Doria (6574)</option>
                <option>Eroski Algaida (6726)</option>
                <option>Eroski Manacor I (6377)</option>
                <option>Eroski Industria (6328)</option>
                <option>Eroski MERCAT NOU (6755)</option>
                <option>Eroski P√©rez Galdos (6756)</option>
                <option>Eroski Pere Garau (6793)</option>
                <option>Eroski Muro (6909)</option>
                <option>Eroski INCA-GRAN V√çA COLOM (6895)</option>
                <option>Eroski Reyes Cat√≥licos (6360)</option>
                <option>Eroski Sa Cabaneta (6852)</option>
              </select>
            </div>

            <div class="mb-3">
              <label for="solicitadoPor" class="form-label">Solicitado por</label>
              <select class="form-select" id="solicitadoPor" required>
                <option value="operario">Operario</option>
                <option value="responsable">Responsable del centro</option>
              </select>
            </div>

            <div class="mb-3">
              <label for="descripcion" class="form-label">Descripci√≥n de la incidencia</label>
              <textarea class="form-control" id="descripcion" rows="3" required></textarea>
            </div>

            <div class="mb-3">
              <label for="materiales" class="form-label">Materiales necesarios</label>
              <input type="text" class="form-control" id="materiales" placeholder="Ej: Destornillador, tornillos M5, etc." />
            </div>

            <div class="mb-3">
              <label for="foto" class="form-label">Adjuntar foto (opcional)</label>
              <input type="file" class="form-control" id="foto" accept="image/*" />
            </div>

            <button type="submit" class="btn btn-primary">Registrar Incidencia</button>
          </form>
        </div>
      </div>
    </div>

    <!-- 2. INCIDENCIAS ABIERTAS -->
    <div class="tab-pane fade" id="abiertas">
      <div class="search-section mb-4">
        <h6>Filtrar Incidencias Abiertas</h6>
        <div class="row g-2">
          <div class="col-md-4">
            <input type="text" class="form-control form-control-sm" id="searchOpen" placeholder="Buscar texto..." />
          </div>
          <div class="col-md-4">
            <select class="form-select form-select-sm" id="filterCentroOpen">
              <option value="">Todos los centros</option>
            </select>
          </div>
          <div class="col-md-4">
            <button class="btn btn-sm btn-outline-secondary w-100" id="btnSearchOpen">Buscar</button>
          </div>
        </div>
      </div>
      <div id="listaAbiertas" class="row"></div>
    </div>

    <!-- 3. INCIDENCIAS CERRADAS -->
    <div class="tab-pane fade" id="cerradas">
      <div class="search-section mb-4">
        <h6>Filtrar Incidencias Cerradas</h6>
        <div class="row g-2">
          <div class="col-md-3">
            <input type="text" class="form-control form-control-sm" id="searchClosed" placeholder="Buscar texto..." />
          </div>
          <div class="col-md-3">
            <select class="form-select form-select-sm" id="filterCentroClosed">
              <option value="">Todos los centros</option>
            </select>
          </div>
          <div class="col-md-3">
            <input type="date" class="form-control form-control-sm" id="fechaDesde" />
          </div>
          <div class="col-md-3">
            <input type="date" class="form-control form-control-sm" id="fechaHasta" />
          </div>
          <div class="col-12 mt-2">
            <button class="btn btn-sm btn-outline-secondary w-100" id="btnSearchClosed">Buscar</button>
          </div>
        </div>
      </div>
      <div id="listaCerradas" class="row"></div>
    </div>

  </div>
</div>

<!-- Modal para ver foto -->
<div class="modal fade" id="photoModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-body text-center">
        <img id="modalImage" class="img-fluid" src="" alt="Foto de incidencia"/>
      </div>
    </div>
  </div>
</div>

<!-- Modal para editar incidencia -->
<div class="modal fade" id="editModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Editar Incidencia</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <form id="formEdit">
          <input type="hidden" id="editId"/>
          <div class="mb-3">
            <label>Centro</label>
            <input type="text" class="form-control" id="editCentro" readonly />
          </div>
          <div class="mb-3">
            <label>Solicitado por</label>
            <select class="form-select" id="editSolicitadoPor">
              <option value="operario">Operario</option>
              <option value="responsable">Responsable del centro</option>
            </select>
          </div>
          <div class="mb-3">
            <label>Descripci√≥n</label>
            <textarea class="form-control" id="editDescripcion" rows="3"></textarea>
          </div>
          <div class="mb-3">
            <label>Materiales</label>
            <input type="text" class="form-control" id="editMateriales"/>
          </div>
          <div class="mb-3">