<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Test API GAS</title>
</head>
<body>
  <h1>Test Google Apps Script - POST Corregido</h1>
  <button onclick="probarGET()">Probar GET</button>
  <button onclick="probarPOST()">Probar POST</button>

  <script>
    const API_URL = "https://script.google.com/macros/s/AKfycbyeuIISPCSk6y4Fu9duM31eJZ-4twFlVAZVPa-AaJL3W4QJYTmMLjLeu0PHTz33XUCU/exec"; // ← Pega tu URL aquí

    async function probarGET() {
      try {
        const res = await fetch(API_URL);
        const data = await res.json();
        console.log("GET OK:", data);
        alert("GET OK (mira la consola)");
      } catch (err) {
        console.error("Error GET:", err);
        alert("Error en GET");
      }
    }

    async function probarPOST() {
      try {
        const res = await fetch(API_URL, {
          method: "POST",
          mode: "cors", // ← Ahora puedes usar 'cors' si el script responde bien
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            referencia: "TEST-123",
            centro: "Eroski",
            solicitadoPor: "Tester",
            descripcion: "Incidencia de prueba",
            materiales: "Ninguno",
            foto: "",
            fechaApertura: new Date().toISOString(),
            fechaCierre: "",
            cerrada: false
          })
        });

        const data = await res.json();
        console.log("POST OK:", data);
        
        if (data.success) {
          alert("✅ Incidencia guardada. Refresca tu hoja de cálculo.");
        } else {
          alert("❌ Error: " + data.error);
        }
      } catch (err) {
        console.error("Error POST:", err);
        alert("❌ Error de conexión. Revisa la consola.");
      }
    }
  </script>
</body>
</html>